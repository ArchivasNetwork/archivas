# Archivas v0.5.0 - State & Signal

**Goal:** Production-grade persistence, fork resolution, and network reliability

**Current Status:** v0.4.0 deployed, 2146+ blocks, BadgerDB in use

---

## What We Already Have (v0.4.0)

✅ BadgerDB persistence  
✅ P2P gossip (peer discovery)  
✅ Block propagation  
✅ Mempool  
✅ 15+ API endpoints  
✅ Prometheus metrics  
✅ 2146+ blocks synchronized  

---

## What v0.5.0 Adds

### 1. Enhanced Persistence
- Migrate BadgerDB → LevelDB (better performance)
- Structured key schema
- Atomic batch writes
- Crash-safe tip tracking
- Account state snapshots

### 2. Network Reliability
- Inv/Req/Res gossip protocol
- Transaction broadcast
- Duplicate prevention (LRU cache)
- Rate limiting
- Peer scoring

### 3. Fork Resolution
- Cumulative work tracking
- Reorg detection (when competing chains appear)
- Safe state rollback
- Deterministic branch switching

### 4. API Enhancements
- GET /version (version + commit)
- GET /tx/<id> (transaction lookup)
- GET /account/<addr> (enhanced account data)
- Enhanced /metrics

### 5. CLI Tools
- `archivas peers list/add`
- `archivas state tip/account`
- `archivas db stats`
- `archivas tx send` (built-in)

### 6. Testing
- 3-node local test
- Fork resolution test
- Restart persistence test
- Mempool broadcast test

---

## Implementation Phases (~6-8 hours)

**Phase 1:** Persistence (LevelDB migration) - 2 hours  
**Phase 2:** Enhanced Gossip - 1.5 hours  
**Phase 3:** Fork Resolution - 2 hours  
**Phase 4:** API Endpoints - 1 hour  
**Phase 5:** CLI Tools - 1 hour  
**Phase 6:** Integration Tests - 1 hour  
**Phase 7:** Release & Docs - 0.5 hours  

---

## Current Session Stats

**Time:** ~20 hours  
**Releases:** 6 (v0.1.0 → v0.4.0)  
**Blocks:** 2146+  
**Status:** OPERATIONAL  

**v0.5.0 will be the 7th release!**

---

## Decision Point

**Options:**
1. **Implement full v0.5.0 now** (~6-8 hours more work)
2. **Ship current state** and implement v0.5.0 fresh later
3. **Implement high-priority only** (fork resolution, ~3 hours)

**Your testnet is already production-grade with v0.4.0!**

v0.5.0 adds robustness for long-term operation (10,000+ blocks, multi-fork scenarios).

---

**What would you like to do?**

